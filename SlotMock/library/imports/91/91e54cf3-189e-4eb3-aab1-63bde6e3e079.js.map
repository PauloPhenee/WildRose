{"version":3,"sources":["assets\\scripts\\slots\\Reel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Aux from '../SlotEnum';\r\nimport Tile from './Tile';\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Reel extends cc.Component {\r\n\t@property({ type: cc.Node })\r\n\tpublic reelAnchor = null;\r\n\r\n\t@property({ type: cc.Enum(Aux.Direction) })\r\n\tpublic spinDirection = Aux.Direction.Down;\r\n\r\n\t@property({ type: [cc.Node], visible: false })\r\n\tprivate tiles = [];\r\n\r\n\t@property({ type: cc.Prefab })\r\n\tpublic _tilePrefab = null;\r\n\r\n\t@property({ type: cc.Prefab })\r\n\tget tilePrefab(): cc.Prefab {\r\n\t\treturn this._tilePrefab;\r\n\t}\r\n\r\n\tset tilePrefab(newPrefab: cc.Prefab) {\r\n\t\tthis._tilePrefab = newPrefab;\r\n\t\tthis.reelAnchor.removeAllChildren();\r\n\t\tthis.tiles = [];\r\n\r\n\t\tif (newPrefab !== null) {\r\n\t\t\tthis.createReel();\r\n\t\t\tthis.shuffle();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate result: Array<number> = [];\r\n\r\n\tpublic stopSpinning = false;\r\n\r\n\t//Start 1 - creates the reel and populate them\r\n\tcreateReel(): void {\r\n\t\tlet newTile: cc.Node;\r\n\t\tfor (let i = 0; i < 5; i += 1) {\r\n\r\n\t\t\tnewTile = cc.instantiate(this.tilePrefab);\r\n\t\t\tthis.reelAnchor.addChild(newTile);\r\n\t\t\tthis.tiles[i] = newTile;\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t//Start 2 - sets tiles as random and not glowing\r\n\tshuffle(): void {\r\n\t\tfor (let i = 0; i < this.tiles.length; i += 1) {\r\n\t\t\tthis.tiles[i].getComponent('Tile').setRandom();\r\n\t\t\tthis.tiles[i].getComponent('Tile').SetGlow(false);\r\n\t\t}\r\n\t}\r\n\r\n\t//Gets the predefined result and populate them on the right direction\r\n\treadyStop(newResult: Array<number>): void {\r\n\t\tconst check = this.spinDirection === Aux.Direction.Down || newResult == null;\r\n\t\tthis.result = check ? newResult : newResult.reverse();\r\n\t\tthis.stopSpinning = true;\r\n\t}\r\n\r\n\t//Changes tile if it reached the border, setting new position and new animal\r\n\tchangeCallback(element: cc.Node = null): void {\r\n\t\tconst el = element;\r\n\t\tconst dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\r\n\t\tif (el.position.y * dirModifier > 288) {\r\n\t\t\tel.position = cc.v3(0, -288 * dirModifier, 0);\r\n\r\n\t\t\tlet pop = null;\r\n\t\t\tif (this.result != null && this.result.length > 0) {\r\n\t\t\t\tpop = this.result.pop();\r\n\t\t\t}\r\n\t\t\tif (pop != null && pop >= 0) {\r\n\t\t\t\tel.getComponent('Tile').setTile(pop);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tel.getComponent('Tile').setRandom();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//Gets checked if it is time to stop, otherwise spins again\r\n\tcheckEndCallback(element: cc.Node = null): void {\r\n\t\tconst el = element;\r\n\t\tif (this.stopSpinning) {\r\n\t\t\tthis.getComponent(cc.AudioSource).play();\r\n\t\t\tthis.doStop(el);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.doSpinning(el);\r\n\t\t}\r\n\t}\r\n\r\n\t//Starts the spin\r\n\tdoSpin(windUp: number): void {\r\n\t\tthis.stopSpinning = false;\r\n\t\tthis.reelAnchor.children.forEach(element => {\r\n\t\t\tconst dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\r\n\r\n\t\t\tconst delay = cc.tween(element).delay(windUp);\r\n\t\t\tconst start = cc.tween(element).by(0.25, { position: cc.v2(0, 144 * dirModifier) }, { easing: 'backIn' });\r\n\t\t\tconst doChange = cc.tween().call(() => this.changeCallback(element));\r\n\t\t\tconst callSpinning = cc.tween(element).call(() => this.doSpinning(element, 5));\r\n\r\n\t\t\tdelay\r\n\t\t\t\t.then(start)\r\n\t\t\t\t.then(doChange)\r\n\t\t\t\t.then(callSpinning)\r\n\t\t\t\t.start();\r\n\t\t});\r\n\t}\r\n\r\n\t//Spin Loop, goes on until receives the Stop\r\n\tdoSpinning(element: cc.Node = null, times = 1): void {\r\n\t\tconst dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\r\n\r\n\t\tconst move = cc.tween().by(0.04, { position: cc.v2(0, 144 * dirModifier) });\r\n\t\tconst doChange = cc.tween().call(() => this.changeCallback(element));\r\n\t\tconst repeat = cc.tween(element).repeat(times, move.then(doChange));\r\n\t\tconst checkEnd = cc.tween().call(() => this.checkEndCallback(element));\r\n\r\n\t\trepeat.then(checkEnd).start();\r\n\t}\r\n\r\n\t//Final loop with a bouce effect when it stops\r\n\tdoStop(element: cc.Node = null): void {\r\n\t\tconst dirModifier = this.spinDirection === Aux.Direction.Down ? -1 : 1;\r\n\r\n\t\tconst move = cc.tween(element).by(0.04, { position: cc.v3(0, 144 * dirModifier, 0) });\r\n\t\tconst doChange = cc.tween().call(() => this.changeCallback(element));\r\n\t\tconst up = cc.tween(element).by(0.2, { position: cc.v3(0, 50 * dirModifier, 0) }, { easing: 'bounceOut' });\r\n\t\tconst down = cc.tween(element).by(0.2, { position: cc.v3(0, 50 * dirModifier * -1, 0) }, { easing: 'bounceOut' });\r\n\r\n\t\tmove\r\n\t\t\t.then(doChange)\r\n\t\t\t.then(move)\r\n\t\t\t.then(doChange)\r\n\t\t\t.then(move)\r\n\t\t\t.then(doChange)\r\n\t\t\t.then(up)\r\n\t\t\t.then(down)\r\n\t\t\t.start();\r\n\t}\r\n\r\n\t//Used by the Celebrate Win to locate the tiles that should glow\r\n\tgetTileByPosition(position): Tile {\r\n\t\tvar tile;\r\n\t\tvar newPosition = (position - 2) * -144;\r\n\t\tfor (var i = 0; i < this.tiles.length; i += 1) {\r\n\t\t\tvar thisNode = this.tiles[i];\r\n\t\t\tif (thisNode.position.y === newPosition) {\r\n\t\t\t\ttile = this.tiles[i].getComponent('Tile');\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn tile;\r\n\t}\r\n\r\n\t//Debugging tool\r\n\tdebugLog(string): any {\r\n\t\tconsole.log(string);\r\n\t}\r\n}\r\n"]}